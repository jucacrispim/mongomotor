language: python
docker: true
versions:
  - '3.12'
  - '3.13'

branches:
  - master

steps:
  - name: setup db
    command: ./build-scripts/db.sh

  - name: Run tests
    command: pytest tests/
    timeout: 120


builders:
  - name: Docs
    branches:
      - release

    platform: python3.13

    envvars:
      ENV: ci

    steps:
      - name: Build docs
        command: ./build-scripts/build_docs.sh

      - name: upload docs
        command: ./build-scripts/upload_docs.sh

  - name: Packages
    branches:
      - release

    platform: python3.13

    envvars:
      ENV: ci

    steps:
      - name: Build package
        command: ./build-scripts/create_package.sh

      - name: upload docs to pdj pypi
        command: ./build-scripts/upload_to_pdj.sh

      - name: upload docs to pypi
        command: ./build-scripts/upload_to_pypi.sh
