SETUP_DB:  &SETUP_DB
  - name: setup db
    command: ./build-scripts/db.sh

TESTS_CMD:  &TESTS_CMD
  - name: Run tests
    command: python setup.py test
    timeout: 120

UPLOAD_DOCS_CMD:  &UPLOAD_DOCS_CMD
  - name: Upload documentation
    command: pdj-deployer pdj01 software_deploy mongomotor release


language: python
versions:
  - '3.5'
  - '3.6'
  - '3.7'

branches:
  - master

steps:
  - <<: *TESTS_CMD


builders:
  - name: release
    branches:
      - release

    plugins:
      - name: python-venv
        pyversion: python3.6

    platform: python3.7

    steps:
      - <<: *UPLOAD_DOCS_CMD
